<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FileUploadArea Test</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
  <div id="app">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-3xl font-bold text-center mb-8">FileUploadArea Component Test</h1>
      
      <!-- Test basic functionality -->
      <div class="mb-8">
        <h2 class="text-xl font-semibold mb-4">Video Upload Test</h2>
        <file-upload-area
          :current-file="videoFile"
          @file-selected="handleVideoSelected"
          @validation-error="handleValidationError"
          @file-cleared="handleVideoCleared"
        ></file-upload-area>
      </div>
      
      <!-- Test with custom props -->
      <div class="mb-8">
        <h2 class="text-xl font-semibold mb-4">Image Upload Test (Max 5MB)</h2>
        <file-upload-area
          :max-file-size="5 * 1024 * 1024"
          :accepted-types="['image/jpeg', 'image/png', 'image/gif']"
          :current-file="imageFile"
          title="Upload Image"
          drop-text="Drop image here or click to select"
          @file-selected="handleImageSelected"
          @validation-error="handleValidationError"
          @file-cleared="handleImageCleared"
        ></file-upload-area>
      </div>
      
      <!-- Status -->
      <div class="bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-lg font-semibold mb-4">Status</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="p-3 bg-blue-50 rounded">
            <h4 class="font-medium text-blue-800">Video File</h4>
            <p class="text-sm text-blue-600">{{ videoFile ? videoFile.name + ' (' + formatSize(videoFile.size) + ')' : 'No file selected' }}</p>
          </div>
          <div class="p-3 bg-green-50 rounded">
            <h4 class="font-medium text-green-800">Image File</h4>
            <p class="text-sm text-green-600">{{ imageFile ? imageFile.name + ' (' + formatSize(imageFile.size) + ')' : 'No file selected' }}</p>
          </div>
        </div>
        
        <div v-if="lastError" class="mt-4 p-3 bg-red-50 border border-red-200 rounded">
          <h4 class="font-medium text-red-800">Last Error</h4>
          <p class="text-sm text-red-600">{{ lastError }}</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, computed } = Vue;

    // FileUploadArea component definition
    const FileUploadArea = {
      template: `
        <div class="bg-white rounded-lg shadow-md p-6 max-w-3xl mx-auto">
          <div class="mb-4">
            <h2 v-if="showTitle" class="text-xl font-bold mb-4 text-gray-800">{{ title }}</h2>
            <div 
              class="w-full border-2 border-dashed rounded-lg p-8 mb-6 text-center cursor-pointer transition-colors"
              :class="{ 'border-blue-500 bg-blue-50': isDragging, 'border-gray-300 hover:bg-gray-50': !isDragging }"
              @dragover.prevent="handleDragOver"
              @dragleave.prevent="handleDragLeave"
              @drop.prevent="handleDrop"
              @click="triggerFileInput"
            >
              <div class="flex flex-col items-center justify-center">
                <svg class="w-12 h-12 text-gray-400 mb-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                </svg>
                <p class="mb-2 text-lg font-medium text-gray-700">
                  {{ currentFile ? 'Change file' : dropText }}
                </p>
                <p class="mb-2 text-sm text-gray-500">
                  {{ acceptedTypesText }} (max. {{ formatFileSize(maxFileSize) }})
                </p>
                <span v-if="currentFile" class="text-sm font-medium text-blue-600">
                  {{ currentFile.name }} ({{ formatFileSize(currentFile.size) }})
                </span>
              </div>
              <input
                ref="fileInput"
                type="file"
                class="hidden"
                :accept="acceptAttribute"
                @change="handleFileChange"
              />
            </div>
          </div>

          <div v-if="errorMessage" class="w-full mt-4 p-3 bg-red-100 border border-red-200 text-red-700 rounded-md">
            {{ errorMessage }}
          </div>

          <div v-if="currentFile && showFileInfo" class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <div>
                  <p class="text-sm font-medium text-blue-800">{{ currentFile.name }}</p>
                  <p class="text-xs text-blue-600">{{ formatFileSize(currentFile.size) }}</p>
                </div>
              </div>
              <button
                @click="clearFile"
                class="text-red-600 hover:text-red-800 transition-colors"
                title="Remove file"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      `,
      props: {
        maxFileSize: {
          type: Number,
          default: 100 * 1024 * 1024
        },
        acceptedTypes: {
          type: Array,
          default: () => ['video/mp4', 'video/quicktime', 'video/webm']
        },
        currentFile: {
          type: File,
          default: null
        },
        title: {
          type: String,
          default: 'Upload File'
        },
        showTitle: {
          type: Boolean,
          default: true
        },
        dropText: {
          type: String,
          default: 'Drop file here or click to upload'
        },
        showFileInfo: {
          type: Boolean,
          default: true
        }
      },
      emits: ['file-selected', 'validation-error', 'file-cleared'],
      setup(props, { emit }) {
        const isDragging = ref(false);
        const errorMessage = ref(null);
        const fileInput = ref(null);

        const acceptedTypesText = computed(() => {
          const typeMap = {
            'video/mp4': 'MP4',
            'video/quicktime': 'MOV',
            'video/webm': 'WebM',
            'image/jpeg': 'JPEG',
            'image/png': 'PNG',
            'image/gif': 'GIF',
            'application/pdf': 'PDF',
            'text/plain': 'TXT'
          };
          
          const types = props.acceptedTypes.map(type => typeMap[type] || type.split('/')[1].toUpperCase());
          return types.join(', ') + ' files only';
        });

        const acceptAttribute = computed(() => {
          return props.acceptedTypes.join(',');
        });

        const triggerFileInput = () => {
          fileInput.value.click();
        };

        const handleFileChange = (event) => {
          const selectedFile = event.target.files[0];
          if (selectedFile) {
            processFile(selectedFile);
          }
        };

        const handleDragOver = (event) => {
          event.preventDefault();
          isDragging.value = true;
        };

        const handleDragLeave = (event) => {
          event.preventDefault();
          isDragging.value = false;
        };

        const handleDrop = (event) => {
          event.preventDefault();
          isDragging.value = false;
          
          const droppedFile = event.dataTransfer.files[0];
          if (droppedFile) {
            processFile(droppedFile);
          }
        };

        const processFile = (file) => {
          const validation = validateFile(file);
          
          if (validation.isValid) {
            errorMessage.value = null;
            emit('file-selected', file);
          } else {
            errorMessage.value = validation.error;
            emit('validation-error', validation.error);
          }
        };

        const validateFile = (file) => {
          if (!props.acceptedTypes.includes(file.type)) {
            return {
              isValid: false,
              error: \`Please select a valid file type. Accepted types: \${acceptedTypesText.value}\`
            };
          }
          
          if (file.size > props.maxFileSize) {
            return {
              isValid: false,
              error: \`File is too large. Maximum size is \${formatFileSize(props.maxFileSize)}.\`
            };
          }
          
          return { isValid: true };
        };

        const clearFile = () => {
          errorMessage.value = null;
          if (fileInput.value) {
            fileInput.value.value = '';
          }
          emit('file-cleared');
        };

        const formatFileSize = (bytes) => {
          if (bytes < 1024) {
            return bytes + ' B';
          } else if (bytes < 1024 * 1024) {
            return (bytes / 1024).toFixed(1) + ' KB';
          } else if (bytes < 1024 * 1024 * 1024) {
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
          } else {
            return (bytes / (1024 * 1024 * 1024)).toFixed(1) + ' GB';
          }
        };

        return {
          isDragging,
          errorMessage,
          fileInput,
          acceptedTypesText,
          acceptAttribute,
          triggerFileInput,
          handleFileChange,
          handleDragOver,
          handleDragLeave,
          handleDrop,
          clearFile,
          formatFileSize
        };
      }
    };

    // Main app
    createApp({
      components: {
        FileUploadArea
      },
      setup() {
        const videoFile = ref(null);
        const imageFile = ref(null);
        const lastError = ref(null);

        const handleVideoSelected = (file) => {
          videoFile.value = file;
          lastError.value = null;
          console.log('Video file selected:', file);
        };

        const handleImageSelected = (file) => {
          imageFile.value = file;
          lastError.value = null;
          console.log('Image file selected:', file);
        };

        const handleValidationError = (error) => {
          lastError.value = error;
          console.log('Validation error:', error);
        };

        const handleVideoCleared = () => {
          videoFile.value = null;
          console.log('Video file cleared');
        };

        const handleImageCleared = () => {
          imageFile.value = null;
          console.log('Image file cleared');
        };

        const formatSize = (bytes) => {
          if (bytes < 1024) return bytes + ' B';
          if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
          if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
          return (bytes / (1024 * 1024 * 1024)).toFixed(1) + ' GB';
        };

        return {
          videoFile,
          imageFile,
          lastError,
          handleVideoSelected,
          handleImageSelected,
          handleValidationError,
          handleVideoCleared,
          handleImageCleared,
          formatSize
        };
      }
    }).mount('#app');
  </script>
</body>
</html>